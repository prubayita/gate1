{% load static %}

<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <link
        rel="shortcut icon"
        href="https://upload.wikimedia.org/wikipedia/commons/thumb/f/f4/BMW_logo_%28gray%29.svg/270px-BMW_logo_%28gray%29.svg.png"
        type="image/x-icon"
        />
        <title>BSC Reporting App</title>

        <!-- ========== All CSS files linkup ========= -->
        <link rel="stylesheet" href="{% static 'assets/css/bootstrap.min.css' %}" />
        <link rel="stylesheet" href="{% static 'assets/css/lineicons.css' %}" />
        <link rel="stylesheet" href="{% static 'assets/css/materialdesignicons.min.css' %}" />
        <link rel="stylesheet" href="{% static 'assets/css/fullcalendar.css' %}" />
        <link rel="stylesheet" href="{% static 'assets/css/fullcalendar.css' %}" />
        <link rel="stylesheet" href="{% static 'assets/css/main.css' %}" />
        <style>
          /* Style for the checkout popup */
          .checkbt{
            float: right;
          }
          .checkout-popup {
            display: none;
            position: fixed;
            z-index: 9;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
          }
        
          .checkout-content {
            background-color: white;
            margin: 25% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 300px; /* Smaller width */
            max-width: 80%; /* Set a maximum width to keep it responsive */
            border-radius: 8px; /* Rounded corners */
          }
        
          .close-popup {
            color: #aaaaaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
          }
        
          .close-popup:hover,
          .close-popup:focus {
            color: #000;
            text-decoration: none;
            cursor: pointer;
          }
        
          .checkout-form label {
            display: block;
            margin-bottom: 5px;
          }
        
          .checkout-form input {
            width: 100%;
            padding: 5px;
            margin-bottom: 10px;
          }
        
          .checkout-form button {
            display: block;
            width: 100%;
            padding: 10px;
           
            color: white;
            border: none;
            cursor: pointer;
          }
          /* Styling for the animated card container */
            .animated-card {
              position: relative;
              width: 220px;
              height: 140px;
              margin-top: 10px;
              perspective: 1000px;
              animation: moveCard 3s infinite linear; /* Continuous animation */
            }

            /* Styling for the credit card */
            .credit-card {
              width: 100%;
              height: 100%;
              background-color: #000000;
              border-radius: 10px;
              box-shadow: 0 5px 10px rgba(0, 0, 0, 0.3);
              position: absolute;
              top: 0;
              left: 0;
              transform-origin: center;
            }

            /* Animation to continuously move the credit card */
            @keyframes moveCard {
              0% {
                transform: translateX(0);
              }
              50% {
                transform: translateX(50px);
              }
              100% {
                transform: translateX(0);
              }
            }

            /* Styles for the text on the card */
            .card-text {
              position: absolute;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              font-size: 16px;
              color: #ffffff;
              /* Add any additional styles you want for the text */
            }

        </style>
        
        
    </head>
    <body>
        {% include 'partials/sidebar.html' %}
        {% include 'partials/navbar.html' %}    
        
    
        {% block content %}
        
        {% endblock content %}

          <!-- ========= All Javascript files linkup ======== -->
    <script src="{% static 'assets/js/bootstrap.bundle.min.js' %}"></script>
    <!-- <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"></script> -->
    <script src="{% static 'assets/js/Chart.min.js' %}"></script>
    <script src="{% static 'assets/js/dynamic-pie-chart.js' %}"></script>
    <script src="{% static 'assets/js/moment.min.js' %}"></script>
    <script src="{% static 'assets/js/fullcalendar.js' %}"></script>
    <script src="{% static 'assets/js/jvectormap.min.js' %}"></script>
    <script src="{% static 'assets/js/world-merc.js' %}"></script>
    <script src="{% static 'assets/js/polyfill.js' %}"></script>
    <script src="{% static 'assets/js/main.js' %}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
     
      <!--waiting list-->
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const formPopup = document.getElementById("formPopup");
            const approvalForm = document.getElementById("approvalForm");
            const deleteForm = document.getElementById("deleteForm");
            const openFormLinks = document.querySelectorAll(".open-form-popup");
    
            openFormLinks.forEach(link => {
                link.addEventListener("click", function (event) {
                    event.preventDefault();
                    const visitorId = link.getAttribute("data-visitor-id");
                    // Set the form action URL based on the visitor ID
                    approvalForm.action = `/approve/${visitorId}/`;
                    deleteForm.action = `/delete/${visitorId}/`;
                    // Show the form popup
                    const bootstrapModal = new bootstrap.Modal(formPopup);
                    bootstrapModal.show();
                });
            });
        });
    </script>
    <!--for checkout-->
    <script>
      document.addEventListener('DOMContentLoaded', function () {
        const checkoutButton = document.getElementById('checkoutButton');
        const checkoutPopup = document.getElementById('checkoutPopup');
        const closeCheckoutPopup = document.getElementById('closeCheckoutPopup');
        const checkoutSubmit = document.getElementById('checkoutSubmit');
        const cardNumberInput = document.getElementById('cardNumber');
    
        // Function to show the checkout popup
        function showCheckoutPopup() {
          checkoutPopup.style.display = 'block';
          cardNumberInput.focus(); // Set focus to the input box when the popup appears
        }
    
        // Function to hide the checkout popup
        function hideCheckoutPopup() {
          checkoutPopup.style.display = 'none';
        }
    
        checkoutButton.addEventListener('click', showCheckoutPopup);
    
        // Listen for Enter key press on the card input field
        cardNumberInput.addEventListener('keypress', function (event) {
          if (event.key === 'Enter') {
            event.preventDefault(); // Prevent the default form submission behavior
            checkoutSubmit.click(); // Trigger the checkoutSubmit button click event
          }
        });
    
        closeCheckoutPopup.addEventListener('click', hideCheckoutPopup);
    
        window.addEventListener('click', function (event) {
          if (event.target === checkoutPopup) {
            hideCheckoutPopup();
          }
        });
    
        checkoutSubmit.addEventListener('click', function () {
          const cardNumber = cardNumberInput.value;
          if (cardNumber) {
            fetch('{% url "records:manual_checkout" %}', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
                'X-CSRFToken': '{{ csrf_token }}',
              },
              body: `cardNumber=${encodeURIComponent(cardNumber)}`,
            })
              .then(response => response.json())
              .then(data => {
                if (data.success) {
                  hideCheckoutPopup(); // Close the popup after successful checkout
                  location.reload(); // Reload the page after successful checkout
                } else {
                  alert(data.error);
                  cardNumberInput.value = ''; // Clear the input box on error
                }
              })
              .catch(error => {
                console.error('Error:', error);
              });
          } else {
            alert('Please enter a card number.');
            cardNumberInput.value = ''; // Clear the input box on error
          }
        });
      });
    </script>
    
    <!---populate register form -->
    <script>
      var allData = JSON.parse('{{ visitors_list|escapejs }}');
      console.log(allData);
      // Function to populate form fields with user data
      function populateFormFields(user) {
        $('#first_name').val(user.first_name);
        $('#surname').val(user.surname);
        $('#organization').val(user.organization);
        $('#position').val(user.position);
        $('#country_of_origin').val(user.country_of_origin);
        $('#email').val(user.email);
        $('#address').val(user.address);
        $('#mobile_phone').val(user.mobile_phone);
      }

      // Event listener for the search button click
      $('#search_btn').on('click', function() {
        const idPassportInput = $('#id_passport_nbr').val();
        const user = allData.find(user => user.id_passport_nbr === idPassportInput);
        // console.log(user);
        if (user) {
          populateFormFields(user);
          $('#register-form').submit(); // Submit the form programmatically
        } else {
          alert('User not found.');
        }
      });
    </script>
    
    
    
    

    
    </body>
</html>